DCS Remap

Это программное обеспечение (ПО) позволяет выполнять ремап дефектных пикселей, строк и столбцов для  камер Кодак DCS. На текущий момент поддерживаются следующие модели камер - Kodak DCS Proback 645 M/C/H, Kodak DCS 14n, 14nx, SLR/n и SLR/c. Из этого списка камер в значительной степени были оттестированы различные модели Proback и 14nx/SLR/n. Все остальные модели должны работать, но не тестировались.

Небольшое введение

В камерах Кодака для каждого сенсорной сборки (здесь и далее просто сенсор) поставляется специальный калибрационный файл, который описывает отдельные особенности сенсора (здесь и далее просто сенсорный файл). Этот файл хранится во внутренней памяти камеры в значительной степени так же как и прошивка, но в отдельной области недоступной конечному пользователю. У всех камер Кодака в прошивках есть специальный &quot;заводской&quot; режим (здесь и далее просто сервисный режим), в котором есть доступ к этому файлу через меню. Этот сервисный режим может быть инициирован разными способами (вводя специальный ключ в DCS Camera Manager который зависит от регистрационного номера камеры и т.д.). В целях ремапа и упрощения всего процесса с этим ПО поставляется набор прошивок для всех поддерживаемых камер с постоянно включенным сервисным режимом. Для ремапа эти прошивки могут быть временно загружены в камеру и обновлены на старндартные прошивки от Кодака по окончании процесса. Ссылки на эти специальные прошивки опубликованы ниже:

   Kodak Proback 645 M/C/H (включает сервисный режим и добавляет меню &quot;Save IF File&quot;),
   Кодак 14n/14nx (включает сервисный режим и с выходом в сервисное меню по нажатию Hotkey),
   Kodak SLR/n (включает сервисный режим и с выходом в сервисное меню по нажатию Hotkey),
   Kodak SLR/c (включает сервисный режим и с выходом в сервисное меню по нажатию Hotkey),

Сенсорный файл содержит информацию о дефектах сенсора (точки, столбцы и строки). Для ремапа, файл сгружается с камеры (через флешку), обновляется этим ПО и закачивается обратно в камеру новыми данными о ремапе.

Процедура ремапа для Кодаков Proback 645 M/C/H:

1) Установите вышеупомянутую прошивку стандартным способом (дважды) и используйте меню &quot;Save IF File&quot;, чтобы сгрузить сенсорный файл на флеш-карту. Файл будет называться TEST.IF
2) На Proback обычно ремап лучше делать на темных кадрах (где дефектные столбцы заметны при вытягивании теней). Для выполнения ремапа нужен raw файл темного кадра. Рекомендации варьируются для конкретных экземпляров камер, но в общем случае начинать надо с кадра на базовом ISO с закрытой крышкой объектива с выдержкой в пределах 1/2 или 1/4 секунды. Чтобы улучшить стабильность ремапа, можно сделать несколько темных кадров - DCS Remap умеет складывать до 7 raw файлов в медианный стек (что уменьшает шумы и оставляет только стабильные дефекты).
3) Сделайте копию сенсорного файла (на всякий случай) и загрузите сенсорный файл и raw файл(ы) в DCS Remap.
4) Ремап столбцов: настройте установки показа raw файла так чтобы дефекты были хорошо видимы, включите ремап столбцов в панели кнопок, и в большом режиме масштабирования (>=100%) отмечайте дефектные столбцы мышью. Настоятельно рекомендуется использовать Композитный или Полутона как режимы отображения raw файла для ремапов вручную. 
5) Proback не поддерживает строчный ремап, поэтому все что имеет отношение к ремапу строк в DCS Remap будет отключено.
6) Ремап точек: также как и для столбцов может быть сделан вручную, но более эффективно использовать авто ремап с выставленными пороговыми значениями (подробнее ниже).
7) По окончании сохраните ремап и проверьте что получившийся сенсорный файл TEST.IF не превышает размерами оригинальный файл. Загрузите его через флеш-карту в камеру, используя меню &quot;Load IF File&quot;
8) Проверьте новый ремап на нескольких кадрах и если резельтат удовлетворителен, обновите прошивку на стандартную Кодаковскую (дважды).

Процедура ремапа для Кодаков 14n/14nx, SLR/n, SLR/c:

1)  Установите вышеупомянутую прошивку стандартным способом (дважды) и используйте меню &quot;Save IF File&quot;, чтобы сгрузить сенсорный файл на флеш-карту. Файл будет называться TEST.IF
2) Следующий шаг посложнее. У этих камер raw файлы сжаты с потерями и это сжатие может привести к прятянию некоторых слаборазличимых дефектов. DCS Remap все равно может быть использован ремапа этих .DCR файлов но это не самый эффективный способ устранения всех дефектов. Однако же есть более эффективный способ. В сервисном режиме камеры можно выбрать по настоящему &quot;сырой&quot; raw формат в котором никакие коррекции и сжатие не применяются. В меню он выбирается как .RCF формат. Именно этот вормат я рекомендую использовать для ремапа, если использование.DCR не дает приемлемых результатов. Должен предупредить что файл в формате .RCF не содержит никаких коррекций, поэтому даже дефекты уже присутствующие в сенсорном файле все равно будут видны. В отличие от Proback, для ремапа этих камер SLR нужен светлый равномерно освещенный кадр (с экспозицией близко к точке насыщения - поканальные raw значения чуть ниже 3700). Если при съемках используется объектив, удостоверьтесь, что он расфокусирован и кадр снят на f/4 или f/5.6. Опять же, несколько raw кадров могут быть сложены в медианный стек чтобы улучшить стабильность появления дефектов.
3) Сделайте копию сенсорного файла (на всякий случай) и загрузите сенсорный файл и raw файл(ы) в DCS Remap.
4) Ремап столбцов и строк: настройте установки показа raw файла так чтобы дефекты были хорошо видимы, включите ремап столбцов или строк в панели кнопок, и в большом режиме масштабирования (>=100%) отмечайте дефектные столбцы мышью. Настоятельно рекомендуется использовать Композитный или Полутона как режимы отображения raw файла для ремапов вручную. 
5) Ремап точек: также как и для столбцов может быть сделан вручную, но более эффективно использовать авто ремап с выставленными пороговыми значениями (подробнее ниже). Если не удается добыится равномерной засветки по всему кадру (значения падают к краям) что особенно заметно при использовании некорректированных .RCF raw файлов, рекомендуется использовать адаптивный авто ремап (см. ниже для подробного описания работы авто ремапа).
6) По окончании сохраните ремап и проверьте что получившийся сенсорный файл TEST.IF не превышает размерами оригинальный файл. Загрузите его через флеш-карту в камеру, используя меню &quot;Load IF File&quot;
7) Проверьте новый ремап на нескольких кадрах и если резельтат удовлетворителен, обновите прошивку на стандартную Кодаковскую (дважды).

Все вышеуказанное конечно просто рекомендации и не являются ограничениями. Например, вполне возможно использовать ремап вручную с каким угодно raw файлом если дефекты явно видны. Единственное ограничение налагаемое DCS Remap это то что автоматический ремап дефектных точек будет работать только на однородных кадрах (т.е. полностью темных, серых, белых и т.д.).


Установки и функциональность DCS Remap.

Функциональность и установки программы разделены на две функциональные области: все что имеет отношение к отображению raw файлов и все что относится к ремапу дефектов. Именно поэтому большая часть элементов управления пользовательским интерфейсом размещена на двух отдельных вкладках (Дефекты и Отображение RAW).

Все меню (кроме помощи) дублированы кнопками на правой стороне главного окна - по этой причине в этом руководстве элементы меню отдельно не рассматриваются.

У большинства элементов пользовательского интерфейса есть соответствующие всплывающие подсказки чтобы облегчить использование ПО.

Главное окно.

Панель инструментов

Панель инструментов содержит кнопки, которые управляют уровнями увеличения масштаба изображения (100%, Поместить в Окно, Увеличить, выбору уровня увеличения масштаба изображения и Уменьшить), кнопки включения режима ремапа вручную (ремап столбцов, ремап точек и ремап строк) и кнопки выбора языка интерфейса (английский и русский язык).

Масштабирование выбором "Поместить в Окно" немного отличается от обычного подхода используемого в других приложениях. При выборе этого режима масштабирование использует наибольшее значение масштаба изображения (из списка доступных) при котором raw файл полностью поместится в окно программы. Эта величина пересчитывается и меняется при измении размеров окна. Причина для этой реализации проста - масштабирование raw файла со специфическими особенностями отображения нужного для DCS Remap хорошо работает только для некоторых величин масштабирования которые и отобраны в этот список доступных масштабов.

Кнопки включения режима ремапа вручную могут быть выбраны только по одной. Когда соответствующий режим включен, курсор мыши меняется и щелчок мыши на выбранном элементе (строка, столбец или точка) отмечает его как дефект или (если щелкнуть на уже отмеченном дефекте) убирает отметку. Режим ручного ремапа дефектов должен соответствовать выбору дефектов (на вкладке Дефекты). В Proback не поддерживается ремап строк поэтому все утановки связанные со строчным ремапом не доступны.

Строка состояния

В строке состояния отображается динамические статистики и данные - строка и столбец под курсором мыши, raw значения в Красном, Зеленом, Синем и Зеленом 2 каналах для пикселя под курсором мыши (если raw файл загружен), и общее количество отмеченных дефектов для столбцов, точек и строк. Количество отмеченных дефектов зависит от параметров настройки выбора дефектов (на вкладке Дефекты).

Общая секция кнопок

Загрузить IF файл

Загрузить и отобразить сенсорный файл. Если raw файл был уже загружен и не соответствует сенсорному файлу, выводится преупреждение с выбором: загрузить сенсорный файл и отбросить загруженный raw файл или отменить загрузку сенсорного файла.

Загрузить RAW файл(ы)

Загрузить и отобразить один или несколько RAW файлов. Если выбрано несколько файлов одного типа (до 7), то все они складываются в один файл используя медианный стек для уменьшения шумов и нестабильных дефектов. Если сенсорный файл был уже загружен и не соответствует raw файлу, выводится преупреждение с выбором: загрузить raw файл и отбросить загруженный сенсорный файл или отменить загрузку raw файла.

Сохранить ремап

Записывает ремап дефектов в сенсорный файл. После этого сенсорный файл готов для загрузки в камеру. После успешной записи, сенсорный файл перезагружается программой заново для проверки.

Сброс изменений

Сбрасывет все дефекты отмеченные в этой сессии и перезагружает сенсорный файл. Это просто функция отката всех изменений в загруженном сенсорном файле.


Главное окно (вкладка Дефекты)

Эта панель становится доступна при загрузке сенсорного файла. Все доступные параметры настройки и элементы пользовательского интерфейса описаны ниже.

ISO

Позволяют выбирать ISO из списка доступных для ремапа. В выпадающем списке ISO элементы с отметкой обозначают уровни ISO для которых уже существует ремап дефектов. Эта установка влияет на выбор дефектов для показа и производимый ремап. В Кодаковских алгоритмах ремапа, дефекты зарегистрированные для определенного ISO, ремапятся для кадров сделанных на таком же ISO или выше его. Для того чтобы дефект ремапился всегда (т.е. для любого ISO) его надо задавать на самом низком ISO (ISO 6 в Кодаках). Большинство дефектов в файлах блока формирования изображений Кодака - рекордер против той основной ISO. Выбор ISO следует за той же самой логикой - это показывает все дефекты, которые могут быть повторно нанесены на карту в этой ISO. Этот выбор также затрагивает статистики количества дефектов показанные в строке состояния.

Удалите выбраные

Удаляет все дефекты для выбранного ISO и выбранных дефектов (даже дефекты из сенсорного файла существовавшие там до загрузки). Это может быть полезно если ремап нужно начать с нуля (скажем для совершенно нового сенсора с сенсорным файлом от другого подходящего сенсора).

Цвет дефектов

Эта кнопка позволяет выбирать цвета для отображения дефектов. Дефекты всегда отображаются поверх raw файла и эта установка может быть полезной когда выбранный цвет не виден отчетливо на фоне raw файла.


Выбор дефектов

Этот блок установок позволяет выбирать дефекты для отображения и ремапа. При выключении типа дефектов для которых на текущий момент включен ремап вручную (кнопки на панели инструментов), этот ремап вручную автоматически отключается. Эти установки также влияют на подсчет количества дефектов отображаемый в строке состояния. Установка "Предыдущие дефекты" необходима для показа только дефектов отмеченных в данной сессии.

Пороговые значения для авторемапа

Эти установки позволяют задать пороговые значения каналов используемые для авто ремапа точечных дефектов. Стандартный алгоритм авто ремапа работает сравнивая попиксельные значения из raw файла со средним значеним для канала и отмечая точку как дефектную если разница превышает пороговое значение. При адаптивном ремапе, попиксельные значения из raw файла сравниваются с медианой вычисленной для канала в пределах блока пикселей выбранного размера и отмечаются как дефектные если разница превышает пороговое значение для канала. Стандартный алгоритм авто ремапа работает неплрохо на однородных кадрах (темные кадры для ремапа Proback). Адаптивный ремап работает лучше всего с некорректированными .RCF файлами или в случаях когда тяжело получить raw кадр с однородной засветкой.

Адаптивный ремап

Включает режим адаптивного авто ремапа. Включение этого режима также делает доступным к
выбор размера блока для адаптивного ремапа. Адаптивный ремап разбивает все изображение на блоки обозначенного размера и вычисляет медианы для каждого канала в каждом блоке. Ремап осуществляется сравнивая абсолютные разницы raw значений в блоке с медианами и отмечая точку как дефектную если разница превышает пороговое значение для данного канала.

Размер блока

Позволяет выбрать размер блока (в пикселях) для адаптивного ремапа. Выбор блоков доступен из фиксированного набора от 4x4 до 64x64. Ремап с большими блоками будет менее локализован - больший блок означает потенциально более точную медиану. Меньшие блоки тем не менее более эффективны для ремапа одиночных пикселей.

Пороги из RAW

Нажатие этой кнопки пытается определить или переопределить пороговые значения для всех каналов из загруженного raw файла. Эта функциональность будет работать только на кадрах с однородной засветкой (черный или светлый кадры).

Авто ремап

Нажим этой кнопки выполнит стандартную или адаптивную авто ремап пунктов согласно отобранным параметрам.

В настоящее время нагруженная СЫРАЯ статистика

Это показывает статистику для нагруженных сырых каналов файла - минута, макс. и средние значения и количество дефектов, которые были бы автомобилем, повторно нанесенным на карту с текущими параметрами настройки.


Главное окно (вкладка Отображение RAW)

Эта панель становится доступна при загрузке raw файла. Все доступные параметры настройки и элементы пользовательского интерфейса описаны ниже.

Первая группа контроля предоставляет 3 возможности, которые затрагивают, как сырой файл показан.

RGB отдают

Когда отобрано сырой файл показан, используя RGB, отдающий для каждого пикселя. Недостающие цвета взяты от соседних пикселей в блоке на 2x2 пикселя, таким образом заставляющем это эффективно показывать большие 2x2 пикселя (каждый 2x2, блок RGBG2 заканчивает тем, что был того же самого цвета). Очень удобно определить цветовые различия в пикселях, но не очень полезное для ремап - так как каждый дефект обнаружится как 2x2 блок. Для ручной ремап я рекомендовал бы использовать его, чтобы определить дефекты и затем околдовать к одному из других двух методов, чтобы фактически повторно нанести на карту дефекты. Строка состояния в этом способе показывает, что ценности RGBG2 для 2x2 блокируют не пиксель.

Соединение

Когда отобрано сырой файл показан, используя пиксельный цвет только. Для Красного пиксель будет красным для Green/Green2, это будет зелено, и для Синего это будет сине. Со всеми каналами, отобранными, который может сделать дефекты более трудными определить так это, хорошо для переотображения себя не для поиска дефектов. 

Шкала яркости

Это - по существу то же самое как соединение, но у каждого пикселя есть все 3 компонента (R, G и B) набор к основной пиксельной стоимости. Это - в основном сложный способ, показанный в шкале яркости. Это - компромисс между Соединением, и RGB Отдают и могут использоваться для поиска дефектов, а также переотображения.

Выбор канала

Они набор флажков позволяют выбирать сырые каналы, которые будут показаны. Отсеянные каналы просто предоставлены черные. Расположение каналов следует за образцом Байера так колонки, и ряды соответствуют тем на датчике (для более легкой отмены выбора ровных/странных рядов и колонок).

Гамма 2.2

Это позволяет гамму, 2.2 исправления относились к исходным данным и улучшают показ сырых файлов (и потребность применить большое исправление воздействия).

Уровень черного zeroed

Это включает различный метод применения уровня черного. Когда отобрано уровни черного просто zeroed. Т.е. каждая стоимость до отобранного уровня черного в канале установлена в 0. Когда это не отобрано, уровни черного, вычисленные традиционным вычитанием. Это могло быть полезно для определения слабых дефектных колонок в темных структурах для Проспины и позволено по умолчанию.

WB (от СЫРЬЯ)

Эта кнопка устанавливает все параметры настройки повышения воздействия за канал во множители баланса белого, извлеченные из сырого файла (если ни один не определен, это использует дневного света, обеспеченные LibRaw). Это абсолютно бесполезно для ремапа, но хорошо, чтобы иметь для игры с сырыми файлами, и анализ почты повторно нанес на карту сырье (чтобы заставить их выглядеть более естественными).

Исправления сброса

Сброс все воздействие, исправления контрастного и уровня черного, когда нажато.

Повышение воздействия

Этот набор ползунков и ценностей управляет исправлениями воздействия. Ценности для них обозначены на остановках и покрывают диапазон от-5 до +5 остановок. У ценностей числа есть больше точности, чем ползунки, но урегулирование воздействия с ползунками быстрее. Исправление воздействия может быть сделано на отдельных уровнях канала и в целом. Эти средства управления должны использоваться, чтобы поднять темные сырые области в Proback ремап к видимому диапазону и сделать дефекты в определенных каналах более видными.

Контраст

У этой секции есть связанные ползунки двух контрастов. Контрастный ползунок управляет уровнем контрастного примененного повышения (крутизна наклона S-кривой). Ползунок Середины управляет срединной точкой контраста S кривая. Эти средства управления должны использоваться, чтобы сделать дефект более видным (и довольно полезны для Проспины темные ремап структуры).

Уровни черного

Они управляют, устанавливает уровни черного для каждого канала. Они могут использоваться, чтобы выключить шум, повышая ISO на темных сырых файлах. 


Заказ исправлений

Все исправления применены к исходным данным в этом заказе: уровни черного-&gt; гамма-&gt; исправление воздействия-&gt; контраст.



