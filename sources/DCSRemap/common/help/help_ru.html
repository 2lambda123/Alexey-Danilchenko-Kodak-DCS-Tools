<html>

<head>
<title>DCS Remap Help</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style>
div.content {
    width: 900px;
    margin: 0 auto;     
}
div.image {
    width: 900px;
    margin: 0 auto;     
}
body {
    font-family:Arial,Helvetica,sans-serif;
} 
</style>
</head>

<body>

<div class="content">

<h1>DCS Remap</h1>

<p>Это программное обеспечение (ПО) позволяет выполнять ремап дефектных пикселей, строк и столбцов для  камер Кодак DCS. На текущий момент поддерживаются следующие модели камер - Kodak DCS Proback 645 M/C/H, Kodak DCS 14n, 14nx, SLR/n и SLR/c. Из этого списка камер в значительной степени были оттестированы различные модели Proback и 14nx/SLR/n. Все остальные модели должны работать, но не тестировались.</p>

<h4><a href="#features">Перейти к разделу помощи по установкам DCS Remap.</a></h4>

<p>&nbsp;</p>

<h2>Небольшое введение</h2>
<p>В камерах Кодака для каждой сенсорной сборки (здесь и далее просто сенсор) поставляется специальный калибрационный файл, который описывает особенности сенсора (здесь и далее просто сенсорный файл). Этот файл хранится во внутренней памяти камеры в значительной степени так же как и прошивка, но в отдельной области недоступной конечному пользователю. У всех камер Кодака в прошивках есть специальный &quot;заводской&quot; режим (здесь и далее просто сервисный режим), в котором есть доступ к этому файлу через меню. Этот сервисный режим может быть инициирован разными способами (вводя специальный ключ в DCS Camera Manager который зависит от регистрационного номера камеры и т.д.). В целях ремапа и упрощения всего процесса с этим ПО поставляется набор прошивок для всех поддерживаемых камер с постоянно включенным сервисным режимом. Для ремапа эти прошивки могут быть временно загружены в камеру и обновлены на стандартные прошивки от Кодака по окончании процесса. Ссылки на эти специальные прошивки опубликованы ниже:</p>

<p>&nbsp;</p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<a href="../firmware/PB645.bin">
Kodak Proback 645 M/C/H (включает сервисный режим и добавляет меню &quot;Save IF File&quot;)</a></p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<a href="../firmware/PRO14N.bin">
Кодак 14n/14nx (включает сервисный режим и с выходом в сервисное меню по нажатию Hotkey)</a></p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<a href="../firmware/PROSLRN.bin">
Kodak SLR/n (включает сервисный режим и с выходом в сервисное меню по нажатию Hotkey)</a></p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<a href="../firmware/PROSLRC.bin">
Kodak SLR/c (включает сервисный режим и с выходом в сервисное меню по нажатию Hotkey)</a></p>

<p>&nbsp;</p>

<p>Сенсорный файл содержит информацию о дефектах сенсора (точки, столбцы и строки). Для ремапа, файл сгружается с камеры (через флешку), обновляется этим ПО и закачивается обратно в камеру c обновленными данными о ремапе.</p>

<p>&nbsp;</p>

<h3>Процедура ремапа для Кодаков Proback 645 M/C/H:</h3>

<ul>
<li>Установите вышеупомянутую прошивку стандартным способом (дважды) и используйте меню &quot;Save IF File&quot;, чтобы сгрузить сенсорный файл на флеш-карту. Файл будет называться TEST.IF</li>

<li>На Proback обычно ремап лучше делать на темных кадрах (где дефектные столбцы заметны при вытягивании теней). Для выполнения ремапа нужен raw файл темного кадра. Рекомендации варьируются для конкретных экземпляров камер, но в общем случае начинать надо с кадра на базовом ISO с закрытой крышкой объектива с выдержкой в пределах 1/2 или 1/4 секунды. Чтобы улучшить стабильность ремапа, можно сделать несколько темных кадров - DCS Remap умеет складывать до 7 raw файлов в медианный стек (что уменьшает шумы и оставляет только стабильные дефекты).</li>

<li>Сделайте копию сенсорного файла (на всякий случай) и загрузите сенсорный файл и raw файл(ы) в DCS Remap.</li>

<li>Ремап столбцов: настройте установки показа raw файла так чтобы дефекты были хорошо видимы, включите ремап столбцов в панели кнопок, и в большом режиме масштабирования (>=100%) отмечайте дефектные столбцы мышью. Настоятельно рекомендуется использовать Композитный или Полутона как режимы отображения raw файла для ремапов вручную.</li>

<li>Proback не поддерживает строчный ремап, поэтому все что имеет отношение к ремапу строк в DCS Remap будет отключено.</li>

<li>Ремап точек: также как и для столбцов может быть сделан вручную, но более эффективно использовать авто ремап с выставленными пороговыми значениями (подробнее ниже).</li>

<li>По окончании сохраните ремап и проверьте что получившийся сенсорный файл TEST.IF не превышает размерами оригинальный файл. Загрузите его через флеш-карту в камеру, используя меню &quot;Load IF File&quot;</li>

<li>Проверьте новый ремап на нескольких кадрах и если результат удовлетворителен, обновите прошивку на стандартную Кодаковскую (дважды).</li>
</ul>
<p>&nbsp;</p>

<h3>Процедура ремапа для Кодаков 14n/14nx, SLR/n, SLR/c:</h3>
<ul>
<li>Установите вышеупомянутую прошивку стандартным способом (дважды) и используйте меню &quot;Save IF File&quot;, чтобы сгрузить сенсорный файл на флеш-карту. Файл будет называться TEST.IF
</li>

<li>Следующий шаг посложнее. У этих камер raw файлы сжаты с потерями и это сжатие может привести к скрыванию некоторых слаборазличимых дефектов. DCS Remap все равно может быть использован ремапа этих .DCR файлов но это не самый эффективный способ устранения всех дефектов. Однако же есть более эффективный способ. В сервисном режиме камеры можно выбрать по настоящему &quot;сырой&quot; raw формат в котором никакие коррекции и сжатие не применяются. В меню он выбирается как .RCF формат. Именно этот формат я рекомендую использовать для ремапа, если использование .DCR не дает приемлемых результатов. Должен предупредить что файл в формате .RCF не содержит никаких коррекций, поэтому даже дефекты уже присутствующие в сенсорном файле все равно будут видны. В отличие от Proback, для ремапа этих камер SLR нужен светлый равномерно освещенный кадр (с экспозицией близко к точке насыщения - поканальные значения в raw файле чуть ниже 3700). Если при съемках используется объектив, удостоверьтесь, что он расфокусирован и кадр снят на f/4 или f/5.6. Опять же, несколько raw кадров могут быть сложены в медианный стек чтобы улучшить стабильность появления дефектов.
</li>

<li>Сделайте копию сенсорного файла (на всякий случай) и загрузите сенсорный файл и raw файл(ы) в DCS Remap.</li>

<li>Ремап столбцов и строк: настройте установки показа raw файла так чтобы дефекты были хорошо видимы, включите ремап столбцов или строк в панели кнопок, и в большом режиме масштабирования (>=100%) отмечайте дефектные столбцы мышью. Настоятельно рекомендуется использовать Композитный или Полутона как режимы отображения raw файла для ремапов вручную. </li>

<li>Ремап точек: также как и для столбцов может быть сделан вручную, но более эффективно использовать авто ремап с выставленными пороговыми значениями (подробнее ниже). Если не удается добиться равномерной засветки по всему кадру (значения падают к краям) что особенно заметно при использовании некорректированных .RCF raw файлов, рекомендуется использовать адаптивный авто ремап (см. ниже для подробного описания работы авто ремапа).
</li>

<li>По окончании сохраните ремап и проверьте что получившийся сенсорный файл TEST.IF не превышает размерами оригинальный файл. Загрузите его через флеш-карту в камеру, используя меню &quot;Load IF File&quot;</li>

<li>Проверьте новый ремап на нескольких кадрах и если результат удовлетворителен, обновите прошивку на стандартную Кодаковскую (дважды).</li>
</ul>

<p>&nbsp;</p>

<p>Все вышеуказанное конечно просто рекомендации и не являются ограничениями. Например, вполне возможно использовать ремап вручную с каким угодно raw файлом если дефекты явно видны. Единственное ограничение налагаемое DCS Remap это то что автоматический ремап дефектных точек будет работать только на однородных кадрах (т.е. полностью темных, серых, белых и т.д.).</p>

<p>&nbsp;</p>

<h2 id="features">Установки и функциональность DCS Remap</h2>

<p>Функциональность и установки программы разделены на две функциональные области: все что имеет отношение к отображению raw файлов и все что относится к ремапу дефектов. Именно поэтому большая часть элементов управления пользовательским интерфейсом размещена на двух отдельных вкладках (Дефекты и Отображение RAW).</p>

<p>Все меню (кроме помощи) дублированы кнопками на правой стороне главного окна - по этой причине в этом руководстве элементы меню отдельно не рассматриваются.</p>

<p>У большинства элементов пользовательского интерфейса есть соответствующие всплывающие подсказки чтобы облегчить использование ПО.</p>

<h4><a href="#defects">Помощь по вкладке Дефекты</a></h4>
<h4><a href="#raw_display">Помощь по вкладке Отображение RAW</a></h4>

<p>&nbsp;</p>

<h3>Главное окно</h3>
</div>
<div class="image">
<p><img src="page0_ru.jpg"></p>
</div>
<div class="content">
<h4>&nbsp;</h4>

<h4>Панель инструментов</h4>

<p>Панель инструментов содержит кнопки, которые управляют уровнями увеличения масштаба изображения (100%, Поместить в Окно, Увеличить, выбору уровня увеличения масштаба изображения и Уменьшить), кнопки включения режима ремапа вручную (ремап столбцов, ремап точек и ремап строк) и кнопки выбора языка интерфейса (английский и русский язык).</p>

<p>&nbsp;</p>

<p>Масштабирование выбором &quot;Поместить в Окно&quot; немного отличается от обычного подхода используемого в других приложениях. При выборе этого режима масштабирование использует наибольшее значение масштаба изображения (из списка доступных) при котором raw файл полностью поместится в окно программы. Эта величина пересчитывается и меняется при изменении размеров окна. Причина для этой реализации проста - масштабирование raw файла со специфическими особенностями отображения нужного для DCS Remap хорошо работает только для некоторых величин масштабирования которые и отобраны в этот список доступных масштабов.</p>

<p>&nbsp;</p>

<p>Кнопки включения режима ремапа вручную могут быть выбраны только по одной. Когда соответствующий режим включен, курсор мыши меняется и щелчок мыши на выбранном элементе (строка, столбец или точка) отмечает его как дефект или (если щелкнуть на уже отмеченном дефекте) убирает отметку. Режим ручного ремапа дефектов должен соответствовать выбору дефектов (на вкладке Дефекты). В Proback не поддерживается ремап строк поэтому все установки связанные со строчным ремапом не доступны.</p>

<p>&nbsp;</p>

<h4>Строка состояния</h4>

<p>В строке состояния отображается динамические статистики и данные - строка и столбец под курсором мыши, raw значения в Красном, Зеленом, Синем и Зеленом_2 каналах для пикселя под курсором мыши (если raw файл загружен), и общее количество отмеченных дефектов для столбцов, точек и строк. Количество отмеченных дефектов зависит от параметров настройки выбора дефектов (на вкладке Дефекты).</p>

<p>&nbsp;</p>

<h4>Общая секция кнопок</h4>

<p>&nbsp;</p>

<h4>Загрузить IF файл</h4>

<p>Загрузить и отобразить сенсорный файл. Если raw файл был уже загружен и не соответствует сенсорному файлу, выводится предупреждение с выбором: загрузить сенсорный файл и отбросить загруженный raw файл или отменить загрузку сенсорного файла.</p>

<p>&nbsp;</p>

<h4>Загрузить RAW файл(ы)</h4>

<p>Загрузить и отобразить один или несколько RAW файлов. Если выбрано несколько файлов одного типа (до 7), то все они складываются в один файл используя медианный стек для уменьшения шумов и нестабильных дефектов. Если сенсорный файл был уже загружен и не соответствует raw файлу, выводится преупреждение с выбором: загрузить raw файл и отбросить загруженный сенсорный файл или отменить загрузку raw файла.</p>

<p>&nbsp;</p>

<h4>Сохранить ремап</h4>

<p>Записывает ремап дефектов в сенсорный файл. После этого сенсорный файл готов для загрузки в камеру. После успешной записи, сенсорный файл перезагружается программой заново для проверки.</p>

<p>&nbsp;</p>

<h4>Сброс изменений</h4>

<p>Сбрасывает все дефекты отмеченные в этой сессии и перезагружает сенсорный файл. Это просто функция отката всех изменений в загруженном сенсорном файле.</p>

<p>&nbsp;</p>

<p>&nbsp;</p>

<h3 id="defects">Главное окно (вкладка Дефекты)</h3>

<p>Эта панель становится доступна при загрузке сенсорного файла. Все доступные параметры настройки и элементы пользовательского интерфейса описаны ниже.</p>

</div>
<div class="image">
<p><img src="page0_ru.jpg"></p>
</div>
<div class="content">

<h4>ISO</h4>

<p>Позволяют выбирать ISO из списка доступных для ремапа. В выпадающем списке ISO элементы с отметкой обозначают уровни ISO для которых уже существует ремап дефектов. Эта установка влияет на выбор дефектов для показа и производимый ремап. В Кодаковских алгоритмах ремапа, дефекты зарегистрированные для определенного ISO, ремапятся для кадров сделанных на таком же ISO или выше его. Для того чтобы дефект ремапился всегда (т.е. для любого ISO) его надо задавать на самом низком ISO (ISO 6 в Кодаках). Большинство дефектов в сенсорных файлах Кодака записаны именно с этим  базовым ISO. Выбор ISO следует за той же самой логикой - это показывает все дефекты, которые могут быть повторно нанесены на карту в этой ISO. Этот выбор также затрагивает статистики количества дефектов показанные в строке состояния.</p>

<p>&nbsp;</p>

<h4>Удалить выбранные</h4>

<p>Удаляет данные ремапа для выбранного ISO и выбранных дефектов (даже дефекты из сенсорного файла существовавшие там до загрузки). Это может быть полезно если ремап нужно начать с нуля (скажем для совершенно нового сенсора с сенсорным файлом от другого подходящего сенсора).</p>

<p>&nbsp;</p>

<h4>Цвет дефектов</h4>

<p>Эта кнопка позволяет выбирать цвета для отображения дефектов. Дефекты всегда отображаются поверх raw файла и эта установка может быть полезной когда выбранный цвет не виден отчетливо на фоне raw файла.</p>

<p>&nbsp;</p>

<h4>Выбор дефектов</h4>

<p>Этот блок установок позволяет выбирать дефекты для отображения и ремапа. При выключении типа дефектов для которых на текущий момент включен ремап вручную (кнопки на панели инструментов), этот ремап вручную автоматически отключается. Эти установки также влияют на подсчет количества дефектов отображаемый в строке состояния. Установка &quot;Предыдущие дефекты&quot; необходима для показа только дефектов отмеченных в данной сессии.</p>

<p>&nbsp;</p>

<h4>Пороговые значения для авторемапа</h4>

<p>Эти установки позволяют задать пороговые значения каналов используемые для авто ремапа точечных дефектов. Стандартный алгоритм авто ремапа работает сравнивая попиксельные значения из raw файла со средним значением канала и отмечая точку как дефектную если разница превышает пороговое значение. При адаптивном ремапе, попиксельные значения из raw файла сравниваются с медианой вычисленной для канала в пределах блока пикселей выбранного размера и отмечаются как дефектные если разница превышает пороговое значение для канала. Стандартный алгоритм авто ремапа неплохо работает на однородных кадрах (темные кадры для ремапа Proback). Адаптивный ремап работает лучше с некорректированными .RCF файлами или в случаях когда тяжело получить raw кадр с однородной засветкой.</p>

<p>&nbsp;</p>

<h4>Адаптивный ремап</h4>
<p>Включает режим адаптивного авто ремапа. Включение этого режима также делает доступным выбор размера блока для адаптивного ремапа. Адаптивный ремап разбивает все изображение на блоки обозначенного размера и вычисляет медианы для каждого канала в каждом блоке. Ремап осуществляется сравнивая абсолютные разницы raw значений в блоке с медианами и отмечая точку как дефектную если разница превышает пороговое значение для данного канала.</p>

<p>&nbsp;</p>

<h4>Размер блока</h4>

<p>Позволяет выбрать размер блока (в пикселях) для адаптивного ремапа. Выбор блоков доступен из фиксированного набора от 4x4 до 64x64. Ремап с большими блоками будет менее локализован - больший блок означает потенциально более точную медиану. Меньшие блоки тем не менее более эффективны для ремапа одиночных пикселей.</p>

<p>&nbsp;</p>

<h4>Пороги из RAW</h4>

<p>Нажатие этой кнопки пытается определить или переопределить пороговые значения для всех каналов из загруженного raw файла. Эта функциональность будет работать только на кадрах с однородной засветкой (черный или светлый кадры).</p>

<p>&nbsp;</p>

<h4>Авто ремап</h4>

<p>Выполняет стандартный или адаптивный (в зависимости от установок) авто ремап точечных дефектов согласно выбранным параметрам.</p>

<p>&nbsp;</p>

<h4>Статистики загруженного RAW</h4>

<p>Эта секция содержит поканальные статистики для загруженных raw файлов - минимум, максимум и средние значения в каналах а также количество дефектов найденных согласно текущим параметрами авто ремапа (то есть те дефекты что будут добавлены в ремап при выборе авто ремапа).</p>

<p>&nbsp;</p>

<h3 id="raw_display">Главное окно (вкладка Отображение RAW)</h3>

<p>Эта панель становится доступна при загрузке raw файла. Все доступные параметры настройки и элементы пользовательского интерфейса описаны ниже.</p>

</div>
<div class="image">
<p><img src="page1_ru.jpg"></p>
</div>
<div class="content">

<p>Первая группа элементов управления определяет один из трех способов отображения raw файла.</p>

<p>&nbsp;</p>

<h4>RGB режим</h4>

<p>Raw файл отображается используя RGB значения для каждого пикселя. Недостающие цвета в каждой точке Байеровской матрицы взяты из соседних пикселей блока 2x2. В результате в этом режиме блоки 2x2 пикселей отображаются одинаковым цветом. Этот режим дает аппроксимацию полноцветного изображения и достаточно удобен для определения попиксельных цветовых различий, но не очень полезен для ремапа (так как точное положение дефектной точки невозможно определить в блоке 2x2). Для ремапа вручную рекомендуется использовать этот режим для нахождения дефектов с последующей сменой режима на один из двух других для ремапа. Индивидуальные цветовые значения в raw каналах в этом режиме показывается для блоков 2x2 пикселей.</p>

<p>&nbsp;</p>

<h4>Композитный</h4>

<p>В этом режиме raw файл отображается используя только цвет каждого конкретного пикселя для каждого канала. Для Красного канала пиксель будет прорисован красным для Зеленого и Зеленого 2 - зеленым и для Синего - синим.  В этом режиме может быть весьма затруднительно искать дефекты если все каналы выбраны для отображения.</p>

<p>&nbsp;</p>

<h4>Полутона</h4>

<p>Этот режим по существу то же самое что и Композитный, но у каждого пикселя все три цветовые компоненты (красный, синий и зеленый) устанавливаются в одно и то же значение (из raw файла). По сути это Композитный режим где все каналы отображаются в полутонах. Этот режим - неплохой компромисс между двумя предыдущими режимами и в нем можно как искать дефекты, так и осуществлять ремап.</p>

<p>&nbsp;</p>

<h4>Выбор канала</h4>

<p>Позволяет выбрать каналы raw файла участвующие в формировании изображения. Не выбранные каналы просто отображаются черным. Относительное расположение каналов следует матрице Байера используемой Кодаком - соответственно цветам столбцов и строк на сенсоре (это полезно для легкого выбора или наоборот убирания четных/нечетных столбцов и строк).</p>

<p>&nbsp;</p>

<h4>Гамма 2.2</h4>

<p>Включает использование гаммы 2.2 для улучшения отображения raw файла.</p>

<p>&nbsp;</p>

<h4>Обнулять ур.черного</h4>

<p>Включает нестандартный метод вычитания уровня черного. Если установка выбрана, то уровень черного просто обнуляется. Т.е. каждое значение в raw файле меньше специфицированного значения уровня черного в канале устанавливается в 0. Если установка не выбрана, то уровни черного вычисляются традиционным вычитанием. Может быть полезно для поиска слабовыраженных дефектных столбцов в темных кадрах для ремапа Proback.</p>

<p>&nbsp;</p>

<h4>ББ (из RAW)</h4>

<p>Устанавливает поканальную экспокоррекцию соответственно с коэффициентами баланса белого, извлеченными из raw файла (или дневного ББ предоставляемое LibRaw). Абсолютно бесполезно для ремапа, но удобно для экспериментов с raw файлами.</p>

<p>&nbsp;</p>

<h4>Сброс коррекций</h4>

<p>Сбрасывет все коррекции в установки по умолчанию - экспозицию, контраста и уровня черного.</p>

<p>&nbsp;</p>

<h4>Экспокоррекция</h4>

<p>Этот набор ползунков и значений управляет экспокоррекцией. Значения выражены в стопах и покрывают диапазон от -5 до +5 стопов. Выставление числовых значений дает большую точности чем ползунки но начальная с ползунками - быстрее. Экспокоррекция может быть проделана как для на отдельных каналов так и в целом для всех каналов сразу. Экспокоррекцией надо использоваться чтобы вытянуть тени (в темных кадрах для ремапа Proback) в видимый диапазон и сделать дефекты в определенных каналах более видными.</p>

<p>&nbsp;</p>

<h4>Контраст</h4>

<p>В этой секции находятся два ползунка для управления контрастом. Ползунок Контраст управляет уровнем контраста (крутизна наклона S-кривой). Ползунок Сред.точки управляет средней точкой контраста S кривой (точкой перелома). Эти коррекции необходимы для того чтобы сделать дефект более заметным.</p>

<p>&nbsp;</p>

<h4>Уровни черного</h4>

<p>Позволяют установить уровни черного для каждого канала. Они могут использоваться, к примеру, чтобы отсечь шум при повышении экспокоррекции темных raw файлов.</p>

<p>&nbsp;</p>

<h4>Последовательность коррекций</h4>

<p>Все коррекции применяются к raw данным в следующей последовательности: <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;уровни черного -&gt; гамма -&gt; экспокоррекция -&gt; контраст.</p>

<p>&nbsp;</p>

</div>

</body>

</html>
